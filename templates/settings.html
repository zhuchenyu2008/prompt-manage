{% extends 'layout.html' %}
{% block title %}设置 - Prompt 管理器{% endblock %}
{% block content %}
  <div class="back-line">
    <a href="{{ url_for('index') }}" class="btn ghost back-btn" onclick="if (window.history.length > 1) { history.back(); return false; }">
      <i class="fas fa-arrow-left"></i>
      返回
    </a>
  </div>
  <div class="page-header">
    <h1 class="page-title">
      <i class="fas fa-cog"></i>
      系统设置
    </h1>
    <p class="page-subtitle">管理您的提示词库配置</p>
  </div>

  <div class="settings-container">

    <form method="post" enctype="multipart/form-data" class="settings-form">
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-broom"></i>
          <h3>版本历史清理</h3>
        </div>
        <div class="section-content">
          <p class="help-text">
            <i class="fas fa-info-circle"></i>
            每个提示词仅保留最近 N 个版本，超出将自动清理（默认 200）。
          </p>
          <div class="form-group">
            <label>
              <i class="fas fa-hashtag"></i>
              清理阈值 N
              <div class="input-wrapper">
                <input type="number" name="version_cleanup_threshold" min="1" value="{{ threshold }}" />
                <span class="input-suffix">个版本</span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <div class="settings-divider"></div>

      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-exchange-alt"></i>
          <h3>数据导入 / 导出</h3>
        </div>
        <div class="section-content">
          <div class="import-export-grid">
            <div class="export-section">
              <div class="action-header">
                <i class="fas fa-download"></i>
                <h4>导出数据</h4>
              </div>
              <p class="action-description">
                将所有提示词和版本历史导出为 JSON 格式文件
              </p>
              <a href="{{ url_for('export_all') }}" class="btn primary export-btn">
                <i class="fas fa-file-export"></i>
                导出全部数据
              </a>
            </div>
            
            <div class="import-section">
              <div class="action-header">
                <i class="fas fa-upload"></i>
                <h4>导入数据</h4>
              </div>
              <p class="action-description warning">
                <i class="fas fa-exclamation-triangle"></i>
                导入将覆盖所有现有数据，请谨慎操作
              </p>
              <label class="upload-btn">
                <i class="fas fa-file-import"></i>
                选择 JSON 文件
                <input type="file" name="import_file" accept="application/json" />
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn primary" type="submit">
          <i class="fas fa-save"></i>
          保存设置 / 执行导入
        </button>
        <a href="{{ url_for('index') }}" class="btn ghost">
          <i class="fas fa-times"></i>
          取消
        </a>
      </div>
    </form>
  </div>

  <style>
    .back-line {
      max-width: 800px;
      margin: 0 auto var(--spacing-lg);
      display: flex;
      justify-content: flex-start;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .page-header {
      text-align: center;
      margin-bottom: var(--spacing-3xl);
      animation: fadeInUp 0.6s ease-out;
    }
    
    .page-title {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 var(--spacing-sm) 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }
    
    .page-subtitle {
      font-size: var(--font-size-lg);
      color: var(--muted);
      margin: 0;
    }
    
    .settings-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .settings-form {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      padding: 0;
      overflow: hidden;
    }
    
    .settings-section {
      padding: var(--spacing-2xl);
    }
    
    .settings-section:last-child {
      padding-bottom: var(--spacing-2xl);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }
    
    .section-header i {
      font-size: var(--font-size-xl);
      color: var(--primary);
    }
    
    .section-header h3 {
      font-size: var(--font-size-xl);
      font-weight: 600;
      color: var(--fg);
      margin: 0;
    }
    
    .help-text {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-sm);
      color: var(--muted);
      font-size: var(--font-size-sm);
      line-height: 1.6;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: color-mix(in srgb, var(--primary) 5%, transparent);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--primary);
    }
    
    .help-text i {
      margin-top: 2px;
      opacity: 0.7;
    }
    
    .form-group {
      margin-bottom: var(--spacing-lg);
    }
    
    .form-group label {
      font-weight: 500;
      color: var(--fg);
      font-size: var(--font-size-base);
      margin-bottom: var(--spacing-sm);
    }
    
    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .input-wrapper input {
      flex: 1;
      padding-right: 80px;
    }
    
    .input-suffix {
      position: absolute;
      right: var(--spacing-md);
      color: var(--muted);
      font-size: var(--font-size-sm);
      pointer-events: none;
    }
    
    .settings-divider {
      height: 1px;
      background: var(--border);
      margin: 0 var(--spacing-2xl);
    }
    
    .import-export-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-xl);
    }
    
    .export-section, .import-section {
      padding: var(--spacing-lg);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      background: var(--bg);
      transition: all 0.3s ease;
    }
    
    .export-section:hover, .import-section:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 12px var(--shadow);
    }
    
    .action-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }
    
    .action-header i {
      font-size: var(--font-size-lg);
      color: var(--primary);
    }
    
    .action-header h4 {
      font-size: var(--font-size-base);
      font-weight: 600;
      color: var(--fg);
      margin: 0;
    }
    
    .action-description {
      color: var(--muted);
      font-size: var(--font-size-sm);
      line-height: 1.5;
      margin-bottom: var(--spacing-lg);
    }
    
    .action-description.warning {
      color: var(--del);
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-xs);
    }
    
    .action-description.warning i {
      color: var(--del);
      margin-top: 2px;
    }
    
    .export-btn {
      width: 100%;
      justify-content: center;
    }
    
    .upload-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-lg);
      background: var(--card);
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      color: var(--fg);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      text-align: center;
      width: 100%;
      justify-content: center;
    }
    
    .upload-btn:hover {
      border-color: var(--primary);
      background: color-mix(in srgb, var(--primary) 10%, transparent);
    }
    
    .upload-btn input[type="file"] {
      display: none;
    }
    
    .form-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: flex-end;
      padding: var(--spacing-xl) var(--spacing-2xl);
      background: color-mix(in srgb, var(--card) 50%, transparent);
      border-top: 1px solid var(--border);
    }
    
    @media (max-width: 768px) {
      .page-header {
        margin-bottom: var(--spacing-2xl);
      }
      
      .page-title {
        font-size: var(--font-size-2xl);
      }
      
      .settings-section {
        padding: var(--spacing-lg);
      }
      
      .import-export-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-lg);
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .form-actions .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
{% endblock %}
